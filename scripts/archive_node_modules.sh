archive_if_needed () {
    rm node_modules_backup/node_modules.tar.gz;
    # Compress without timestamps, so that identical `node_modules` will produce identical tarballs
    $1 -c --sort=name --owner=root:0 --group=root:0 --mtime='UTC 2019-01-01' -f node_modules_backup/node_modules.tar node_modules &&
    gzip -n node_modules_backup/node_modules.tar &&

    cp package.json node_modules_backup/package_json_checksum.json &&

    echo "Successfully archived node_modules"
}


archive_if_needed "tar" || (brew install gnu-tar && echo "Installed gtar" && archive_if_needed "gtar") || echo "Failed to archive node_modules"
