archive_if_needed () {
    # Compress without timestamps, so that identical `node_modules` will produce identical tarballs
    $1 -cz --sort=name --owner=root:0 --group=root:0 --mtime='UTC 2019-01-01' -f node_modules_backup/node_modules_backup.tar.gz node_modules &&

    cp package.json node_modules_backup/package_json_checksum.json &&

    echo "Successfully archived node_modules"
}


archive_if_needed "tar" || (brew install gnu-tar && echo "Installed gtar" && archive_if_needed  "gtar") || echo "Failed to archive node_modules"
