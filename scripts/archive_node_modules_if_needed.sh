archive_if_needed () {
    # Compress without timestamps, so that identical `node_modules` will produce identical tarballs
    gnu_tar --sort=name --owner=root:0 --group=root:0 --mtime='UTC 2019-01-01' --to-stdout node_modules | gzip -n --stdout > node_modules_backup/node_modules.tar.gz
}

if tar --mtime='UTC 2019-01-01' /dev/null node_modules; then
  alias gnu_tar="tar"
else
  brew install gnu-tar;
  alias gnu_tar="gtar"
fi

archive_if_needed